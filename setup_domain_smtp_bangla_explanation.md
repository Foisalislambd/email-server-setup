# ЁЯУз Domain-based SMTP Setup Script - ржмрж╛ржВрж▓рж╛ ржмрзНржпрж╛ржЦрзНржпрж╛

## ЁЯОп **рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗрж░ ржЙржжрзНржжрзЗрж╢рзНржп**
ржПржЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржЖржкржирж╛рж░ ржирж┐ржЬрзЗрж░ ржбрзЛржорзЗржЗржи ржжрж┐ржпрж╝рзЗ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп Postfix SMTP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЯржЖржк ржХрж░рзЗред Gmail ржмрж╛ ржЕржирзНржп рж╕рж╛рж░рзНржнрж┐рж╕ ржмрзНржпржмрж╣рж╛рж░ ржирж╛ ржХрж░рзЗ ржЖржкржирж╛рж░ ржирж┐ржЬрзЗрж░ ржбрзЛржорзЗржЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред

## ЁЯУЭ **рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗрж░ ржЕржВрж╢ржЧрзБрж▓рзЛ:**

### **1. ржкрзНрж░рж╛ржержорж┐ржХ рж╕рзЗржЯржЖржк (Lines 1-37)**
```bash
#!/bin/bash
set -e
```
- **ржмрзНржпрж╛ржЦрзНржпрж╛**: рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж╢рзБрж░рзБ ржПржмржВ ржХрзЛржирзЛ ржПрж░рж░ рж╣рж▓рзЗ ржмржирзНржз рж╣ржпрж╝рзЗ ржпрж╛ржмрзЗ
- **рж░ржЩрзЗрж░ ржХрзЛржб**: рж╕ржмрзБржЬ, рж▓рж╛рж▓, рж╣рж▓рзБржж, ржирзАрж▓ рж░ржЩрзЗрж░ ржЬржирзНржп ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓
- **рж▓ржЧрж┐ржВ ржлрж╛ржВрж╢ржи**: рж╕ржлрж▓рждрж╛, рж╕рждрж░рзНржХрждрж╛, ржПрж░рж░ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп

### **2. ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЗржиржкрзБржЯ ржирзЗржУржпрж╝рж╛ (Lines 44-57)**
```bash
read -p "Enter your domain name: " DOMAIN
read -p "Enter email address: " EMAIL_ADDRESS
read -s -p "Enter email password: " EMAIL_PASSWORD
read -p "Enter SMTP port: " SMTP_PORT
read -p "Enter server hostname: " SERVER_HOSTNAME
read -p "Install Let's Encrypt SSL certificate: " INSTALL_SSL
```
- **DOMAIN**: ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи (ржпрзЗржоржи: 100to1shot.com)
- **EMAIL_ADDRESS**: ржЗржорзЗржЗрж▓ ржарж┐ржХрж╛ржирж╛ (ржпрзЗржоржи: noreply@100to1shot.com)
- **EMAIL_PASSWORD**: ржЗржорзЗржЗрж▓рзЗрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб
- **SMTP_PORT**: SMTP ржкрзЛрж░рзНржЯ (ржбрж┐ржлрж▓рзНржЯ: 587)
- **SERVER_HOSTNAME**: рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржирж╛ржо (ржпрзЗржоржи: mail.100to1shot.com)
- **INSTALL_SSL**: SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ ржЗржирж╕рзНржЯрж▓ ржХрж░ржмрзЗ ржХрж┐ржирж╛ (y/n)

### **3. ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи (Lines 61-69)**
```bash
apt update
apt install -y postfix libsasl2-modules libsasl2-2 ca-certificates openssl
```
- **postfix**: ржЗржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржлржЯржУржпрж╝рзНржпрж╛рж░
- **libsasl2-modules**: ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи ржоржбрж┐ржЙрж▓
- **ca-certificates**: SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ
- **openssl**: SSL ржЯрзБрж▓рж╕
- **certbot**: Let's Encrypt SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯрзЗрж░ ржЬржирзНржп (ржпржжрж┐ y ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рж╛ рж╣ржпрж╝)

### **4. Postfix ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи (Lines 71-133)**
```bash
cat > /etc/postfix/main.cf << EOF
myhostname = $SERVER_HOSTNAME
mydomain = $DOMAIN
myorigin = \$mydomain
mydestination = \$myhostname, \$mydomain, localhost, localhost.localdomain
EOF
```
- **myhostname**: рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржирж╛ржо (mail.100to1shot.com)
- **mydomain**: ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи (100to1shot.com)
- **myorigin**: ржЗржорзЗржЗрж▓рзЗрж░ ржЙрзОрж╕
- **mydestination**: ржЧржирзНрждржмрзНржп ржбрзЛржорзЗржЗржи

### **5. SASL ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи (Lines 139-149)**
```bash
cat > /etc/postfix/sasl_passwd << EOF
$SERVER_HOSTNAME:$SMTP_PORT $EMAIL_ADDRESS:$EMAIL_PASSWORD
EOF
chmod 600 /etc/postfix/sasl_passwd
postmap /etc/postfix/sasl_passwd
```
- **sasl_passwd**: ржЗржорзЗржЗрж▓ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯрзЗрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕рзНржЯрзЛрж░ ржХрж░рзЗ
- **chmod 600**: ржлрж╛ржЗрж▓ржЯрж┐ рж╢рзБржзрзБ root ржкржбрж╝рждрзЗ ржкрж╛рж░ржмрзЗ
- **postmap**: ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржлрж╛ржЗрж▓ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рзЗ

### **6. SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи (Lines 171-219)**

#### **Let's Encrypt SSL (ржпржжрж┐ y ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рж╛ рж╣ржпрж╝):**
```bash
certbot certonly --standalone -d "$SERVER_HOSTNAME"
```
- **certbot**: Let's Encrypt SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗ
- **--standalone**: ржирж┐ржЬрзЗ ржирж┐ржЬрзЗ SSL ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗ
- **-d**: рж╢рзБржзрзБ subdomain ржПрж░ ржЬржирзНржп (mail.100to1shot.com)

#### **Self-signed SSL (ржпржжрж┐ n ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рж╛ рж╣ржпрж╝):**
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/ssl/private/ssl-cert-snakeoil.key \
    -out /etc/ssl/certs/ssl-cert-snakeoil.pem \
    -subj "/CN=$SERVER_HOSTNAME"
```
- **openssl**: ржирж┐ржЬрзЗрж░ SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ рждрзИрж░рж┐ ржХрж░рзЗ
- **-x509**: X.509 рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ
- **-nodes**: ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЫрж╛ржбрж╝рж╛
- **-days 365**: рзз ржмржЫрж░ ржмрзИржз
- **-newkey rsa:2048**: 2048-bit RSA ржХрзА

### **7. ржЗржорзЗржЗрж▓ рж╣рзЗржбрж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи (Lines 154-159)**
```bash
cat > /etc/postfix/header_checks << EOF
/^From:.*/ REPLACE From: $EMAIL_ADDRESS
/^Reply-To:.*/ REPLACE Reply-To: $EMAIL_ADDRESS
EOF
```
- **header_checks**: ржЗржорзЗржЗрж▓рзЗрж░ рж╣рзЗржбрж╛рж░ ржарж┐ржХ ржХрж░рзЗ
- **From**: рж╕ржм ржЗржорзЗржЗрж▓рзЗрж░ From ржарж┐ржХрж╛ржирж╛ ржПржХржЗ рж░рж╛ржЦрзЗ
- **Reply-To**: Reply-To ржарж┐ржХрж╛ржирж╛ рж╕рзЗржЯ ржХрж░рзЗ

### **8. ржорзЗржЗрж▓ржирзЗржо ржПржмржВ ржЕрзНржпрж╛рж▓рж┐ржпрж╝рж╛рж╕ рж╕рзЗржЯржЖржк (Lines 223-228)**
```bash
echo "$DOMAIN" > /etc/mailname
echo "root: $EMAIL_ADDRESS" >> /etc/aliases
newaliases
```
- **mailname**: ржбрзЛржорзЗржЗржи ржирж╛ржо рж╕рзЗржЯ ржХрж░рзЗ
- **aliases**: root ржЗржорзЗржЗрж▓ ржЖржкржирж╛рж░ ржЗржорзЗржЗрж▓рзЗ ржлрж░ржУржпрж╝рж╛рж░рзНржб ржХрж░рзЗ
- **newaliases**: ржЕрзНржпрж╛рж▓рж┐ржпрж╝рж╛рж╕ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЖржкржбрзЗржЯ ржХрж░рзЗ

### **9. Postfix рж╕рж╛рж░рзНржнрж┐рж╕ рж╢рзБрж░рзБ (Lines 230-235)**
```bash
systemctl enable postfix
systemctl restart postfix
postfix reload
```
- **enable**: рж╕рж╛рж░рзНржнрж┐рж╕ ржЕржЯрзЛрж╕рзНржЯрж╛рж░рзНржЯ рж╣ржмрзЗ
- **restart**: рж╕рж╛рж░рзНржнрж┐рж╕ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзЗ
- **reload**: ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж░рж┐рж▓рзЛржб ржХрж░рзЗ

### **10. ржЯрзЗрж╕рзНржЯ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛ржирзЛ (Lines 237-266)**
```bash
echo "Test message from $DOMAIN SMTP server" | \
mail -s "Test Email from $DOMAIN" \
-a "From: $EMAIL_ADDRESS" "$EMAIL_ADDRESS"
```
- **mail**: ржЯрзЗрж╕рзНржЯ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛ржпрж╝
- **-s**: рж╕рж╛ржмржЬрзЗржХрзНржЯ
- **-a**: рж╣рзЗржбрж╛рж░ ржпрзЛржЧ ржХрж░рзЗ
- **From**: ржЖржкржирж╛рж░ ржЗржорзЗржЗрж▓ ржарж┐ржХрж╛ржирж╛ ржерзЗржХрзЗ ржкрж╛ржарж╛ржпрж╝

### **11. ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи рждрзИрж░рж┐ (Lines 268-422)**
рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржПржХржЯрж┐ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЧрж╛ржЗржб рждрзИрж░рж┐ ржХрж░рзЗ ржпрж╛рждрзЗ ржЖржЫрзЗ:
- **PHP ржХрзЛржб ржЙржжрж╛рж╣рж░ржг**
- **Python ржХрзЛржб ржЙржжрж╛рж╣рж░ржг**
- **Node.js ржХрзЛржб ржЙржжрж╛рж╣рж░ржг**
- **DNS рж░рзЗржХрж░рзНржб рж╕рзЗржЯржЖржк**
- **ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ ржЧрж╛ржЗржб**

## ЁЯФз **ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:**

### **ржЗржиржкрзБржЯ:**
```
Domain: 100to1shot.com
Email: noreply@100to1shot.com
Hostname: mail.100to1shot.com
SSL: y
```

### **ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛:**
1. **ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓** тЖТ Postfix, SSL ржЯрзБрж▓рж╕
2. **Postfix ржХржиржлрж┐ржЧрж╛рж░** тЖТ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ ржЬржирзНржп
3. **SSL ржЗржирж╕рзНржЯрж▓** тЖТ рж╢рзБржзрзБ subdomain ржП (mail.100to1shot.com)
4. **ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи рж╕рзЗржЯржЖржк** тЖТ ржЖржкржирж╛рж░ ржЗржорзЗржЗрж▓ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ
5. **рж╕рж╛рж░рзНржнрж┐рж╕ рж╢рзБрж░рзБ** тЖТ Postfix ржЪрж╛рж▓рзБ
6. **ржЯрзЗрж╕рзНржЯ** тЖТ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЯрзЗрж╕рзНржЯ

### **ржЖржЙржЯржкрзБржЯ:**
- **ржЗржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░**: mail.100to1shot.com
- **SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ**: рж╢рзБржзрзБ subdomain ржП
- **ржЗржорзЗржЗрж▓ ржарж┐ржХрж╛ржирж╛**: user@100to1shot.com
- **SMTP ржкрзЛрж░рзНржЯ**: 587

## ЁЯОп **ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп:**

1. **ржбрзЛржорзЗржЗржи-ржнрж┐рждрзНрждрж┐ржХ**: ржЖржкржирж╛рж░ ржирж┐ржЬрзЗрж░ ржбрзЛржорзЗржЗржи ржмрзНржпржмрж╣рж╛рж░
2. **SSL ржирж┐рж░рж╛ржкрждрзНрждрж╛**: Let's Encrypt ржмрж╛ Self-signed
3. **Subdomain ржЖрж▓рж╛ржжрж╛**: mail.100to1shot.com (ржорзВрж▓ ржбрзЛржорзЗржЗржи ржЕржХрзНрж╖ржд)
4. **ржЕржЯрзЛржорзЗржЯрж┐ржХ**: рж╕ржм ржХрж┐ржЫрзБ ржЕржЯрзЛ ржХржиржлрж┐ржЧрж╛рж░
5. **ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи**: ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЧрж╛ржЗржб рж╕рж╣

## ЁЯЪА **ржмрзНржпржмрж╣рж╛рж░:**
```bash
sudo ./setup_domain_smtp.sh
```

ржПржЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржЖржкржирж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржЗржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ рждрзИрж░рж┐ ржХрж░ржмрзЗ ржпрж╛ ржЖржкржирж╛рж░ ржирж┐ржЬрзЗрж░ ржбрзЛржорзЗржЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ! ЁЯУзтЬи